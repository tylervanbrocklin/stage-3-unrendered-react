{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _toArray2 = require('babel-runtime/helpers/toArray');\n\nvar _toArray3 = _interopRequireDefault(_toArray2);\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends3 = require('babel-runtime/helpers/extends');\n\nvar _extends4 = _interopRequireDefault(_extends3);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _keys = require('babel-runtime/core-js/object/keys');\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _rules = require('./rules');\n\nvar _rules2 = _interopRequireDefault(_rules);\n\nvar _util = require('./util');\n\nvar util = _interopRequireWildcard(_util);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar allDevices = (0, _keys2.default)(util.devices).map(function (key) {\n  return util.devices[key];\n});\n\nvar severity = function severity(val) {\n  switch (val) {\n    case 0:\n    case 'off':\n      return 'off';\n\n    case 1:\n    case 'warn':\n      return 'warn';\n\n    case 2:\n    case 'error':\n      return 'error';\n\n    default:\n      throw new Error('react-a11y: invalid severity ' + val);\n  }\n};\n\nvar normalize = function normalize() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'off';\n\n  if (Array.isArray(opts)) {\n    opts[0] = severity(opts[0]);\n    return opts;\n  }\n\n  return [severity(opts)];\n};\n\nvar getTests = function getTests(defns) {\n  return Array.isArray(defns) ? defns : [defns];\n};\n\nvar Suite = function () {\n  function Suite(React, ReactDOM, options) {\n    (0, _classCallCheck3.default)(this, Suite);\n    this.options = options;\n    this.React = React;\n    this.ReactDOM = ReactDOM;\n\n    if (!this.React && !this.React.createElement) {\n      throw new Error('Missing parameter: React');\n    }\n\n    var _options$plugins = this.options.plugins,\n        plugins = _options$plugins === undefined ? [] : _options$plugins; // prepare all rules by including every plugin and saving their rules\n    // namespaced like plugin/rule\n\n    this.rules = plugins.map(function (name) {\n      try {\n        // eslint-disable-next-line global-require,import/no-dynamic-require\n        var mod = require('react-a11y-plugin-' + name);\n\n        var rules = 'default' in mod ? mod.default.rules : mod.rules;\n        return (0, _keys2.default)(rules).reduce(function (acc, key) {\n          return (0, _extends4.default)({}, acc, (0, _defineProperty3.default)({}, name + '/' + key, rules[key]));\n        }, {});\n      } catch (err) {\n        throw new Error('Could not find react-a11y-plugin-' + name);\n      }\n    }).reduce(function (acc, next) {\n      return (0, _extends4.default)({}, acc, next);\n    }, _rules2.default);\n  }\n\n  (0, _createClass3.default)(Suite, [{\n    key: 'test',\n    value: function test(tagName, props, children, done) {\n      var _this = this;\n\n      (0, _keys2.default)(this.options.rules).forEach(function (key) {\n        var rule = _this.rules[key]; // ensure that the rule exists\n\n        if (!rule) {\n          throw new Error('react-a11y: rule ' + key + ' not found, ' + 'maybe you\\'re missing a plugin?');\n        } // get options for rule\n\n\n        var _normalize = normalize(_this.options.rules[key]),\n            _normalize2 = (0, _toArray3.default)(_normalize),\n            sev = _normalize2[0],\n            options = _normalize2.slice(1);\n\n        if (sev !== 'off') {\n          var ctx = {\n            options: options,\n            React: _this.React,\n            ReactDOM: _this.ReactDOM\n          };\n          getTests(rule).reduce(function () {\n            var _ref = (0, _asyncToGenerator3.default)(\n            /*#__PURE__*/\n            _regenerator2.default.mark(function _callee(pprev, defn) {\n              var prev, tagNames, msg, url, AX, test, _defn$affects, affects, pass;\n\n              return _regenerator2.default.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.next = 2;\n                      return pprev;\n\n                    case 2:\n                      prev = _context.sent;\n\n                      if (prev) {\n                        _context.next = 5;\n                        break;\n                      }\n\n                      return _context.abrupt('return', prev);\n\n                    case 5:\n                      tagNames = defn.tagName, msg = defn.msg, url = defn.url, AX = defn.AX, test = defn.test, _defn$affects = defn.affects, affects = _defn$affects === undefined ? allDevices : _defn$affects; // filter by tagName\n\n                      if (!Array.isArray(tagNames)) {\n                        _context.next = 11;\n                        break;\n                      }\n\n                      if (!(tagNames.indexOf(tagName) < 0)) {\n                        _context.next = 9;\n                        break;\n                      }\n\n                      return _context.abrupt('return', prev);\n\n                    case 9:\n                      _context.next = 14;\n                      break;\n\n                    case 11:\n                      if (!tagNames) {\n                        _context.next = 14;\n                        break;\n                      }\n\n                      if (!(tagName !== tagNames)) {\n                        _context.next = 14;\n                        break;\n                      }\n\n                      return _context.abrupt('return', prev);\n\n                    case 14:\n                      // perform the test\n                      pass = void 0; // try/catch so that exceptions are not silently swallowed by await\n\n                      _context.prev = 15;\n                      _context.next = 18;\n                      return test(tagName, props, children, ctx);\n\n                    case 18:\n                      pass = _context.sent;\n                      _context.next = 25;\n                      break;\n\n                    case 21:\n                      _context.prev = 21;\n                      _context.t0 = _context['catch'](15);\n                      console.log(_context.t0);\n                      pass = false;\n\n                    case 25:\n                      if (!pass) {\n                        done({\n                          tagName: tagName,\n                          msg: msg,\n                          url: url,\n                          AX: AX,\n                          props: props,\n                          children: children,\n                          severity: sev,\n                          rule: key,\n                          affects: affects\n                        });\n                      }\n\n                      return _context.abrupt('return', prev && pass);\n\n                    case 27:\n                    case 'end':\n                      return _context.stop();\n                  }\n                }\n              }, _callee, _this, [[15, 21]]);\n            }));\n\n            return function (_x2, _x3) {\n              return _ref.apply(this, arguments);\n            };\n          }(), true);\n        }\n      });\n    }\n  }]);\n  return Suite;\n}();\n\nexports.default = Suite;","map":null,"metadata":{},"sourceType":"script"}